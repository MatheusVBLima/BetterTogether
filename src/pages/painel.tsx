import HeaderDashboard from "@/components/headerDashboard/HeaderDashboard";
import PainelContent from "@/components/painelContent/PainelContent";
import { setupApiClient } from "@/services/api";
import { withSSRAuth } from "@/utils/withSSRAuth";
import { withSSRGuest } from "@/utils/withSSRGuest";
import Head from "next/head";
import React from "react";
import { GetServerSidePropsContext } from "next";
import { ParsedUrlQuery } from "querystring";

type userMe = {
  id: number;
  name: string;
  email: string;
  projects: [];
  experiences: [];
};

interface Props {
  userMe: userMe;
}

export default function dashboard({ userMe }: Props) {
  return (
    <div>
      <Head>
        <title>BT | Painel</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        {/*  <link rel='icon' href='/favicon.ico' /> */}
      </Head>
      <HeaderDashboard />
      <PainelContent userMe={userMe} />
    </div>
  );
}

export const getServerSideProps = withSSRAuth(async (ctx) => {
  const apiClient = setupApiClient(ctx);
  let userMe = null;
  try {
    const responseUserMe = await apiClient.get("/me");
    userMe = responseUserMe.data;
  } catch (err) {
    console.log(err);
  }
  return {
    props: {
      userMe: userMe,
    },
  };
});
